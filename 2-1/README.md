1) Построение суффмаса см. РК
2) После нулевой итерации массив lcp, очевидно, должен быть нулевым.

Пусть теперь мы выполнили k-1-ю итерацию, получили от неё массив lcp^, и должны на текущей k-й итерации пересчитать этот массив, получив новое его значение lcp. Как мы помним, в алгоритме построения суффиксного массива циклические подстроки длины 2^k разбивались пополам на две подстроки длины 2^{k-1}; воспользуемся этим же приёмом и для построения массива lcp.

Итак, пусть на текущей итерации алгоритм вычисления суффиксного массива выполнил свою работу, нашёл новое значение перестановки p[] подстрок. Будем теперь идти по этому массиву и смотреть пары соседних подстрок: p[i] и p[i+1], i=0 ... n-2. Разбивая каждую подстроку пополам, мы получаем две различных ситуации: 1) первые половинки подстрок в позициях p[i] и p[i+1] различаются, и 2) первые половинки совпадают (напомним, такое сравнение можно легко производить, просто сравнивая номера классов c[] с предыдущей итерации). Рассмотрим каждый из этих случаев отдельно.

Первые половинки подстрок различались. Заметим, что тогда на предыдущем шаге эти первые половинки необходимо были соседними. В самом деле, классы эквивалентности не могли исчезать (а могут только появляться), поэтому все различные подстроки длины 2^{k-1} дадут (в качестве первых половинок) на текущей итерации различные подстроки длины 2^k, и в том же порядке. Таким образом, для определения {lcp}[i] в этом случае надо просто взять соответствующее значение из массива lcp^.

Первые половинки совпадали. Тогда вторые половинки могли как совпадать, так и различаться; при этом, если они различаются, то они совсем не обязательно должны были быть соседними на предыдущей итерации. Поэтому в этом случае нет простого способа определить {lcp}[i]. Для его определения надо поступить так же, как мы и собираемся потом вычислять наибольший общий префикс для любых двух суффиксов: надо выполнить запрос минимума (RMQ) на соответствующем отрезке массива lcp^

3) За O(n/log n) времени и O(n) памяти мы для каждой пары соседних в порядке сортировки суффиксов найдём длину их наибольшего общего префикса. Найдём теперь по этой информации количество различных подстрок в строке.
Будем рассматривать, какие новые подстроки начинаются в позиции p[i]. Суффикс p[i] даст в качестве новых подстрок все свои префиксы, кроме совпадающих с префиксами суффикса p[i-1]. Т.е. все его префиксы, кроме {\rm lcp}[i-1] первых, дадут новые подстроки. Значит количество различных подстрок:
![alt text](http://www.e-maxx-ru.1gb.ru/tex2png/cache/97acc8c31d5aa1d426f281e3d94ffddb.png)
